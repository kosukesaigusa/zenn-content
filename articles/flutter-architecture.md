---
title: "マルチパッケージを活用した Flutter のアーキテクチャ"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Dart", "Flutter"]
published: false
published_at: 2024-08-01 00:00
---

## はじめに

これまで本業、副業、プライベートで様々なプロジェクトの開発に携わってきて、それぞれのプロジェクトで様々な課題に直面してきました。

また、直近でも全く新しい Flutter のプロジェクトを立ち上げるにあたり、どのようなアーキテクチャにすれば長期的に恩恵を受けることができるかを考えてきました。

この記事では、そのような過程でまとまってきた、マルチパッケージを活用した Flutter のアーキテクチャについて紹介します。

## この記事で触れること

この記事では、Flutter のアーキテクチャについて説明するにあたり、下記のような内容に触れます。

- Dart, Flutter のパッケージと依存関係について
- Dart と Flutter の境界について
- ドキュメンテーションについて
- 例外処理について
- ユニットテストについて
- ... など

## この記事で紹介するアーキテクチャ

## feature ファーストか layer ファーストか？

いろいろな作法が見受けられる Flutter アプリのアーキテクチャに関する議論をする時、ディレクトリやパッケージをどのように切るか、という観点で、feature ファーストか layer ファーストかというトピックがあがります。

この記事では、PDS (Presentation Domain Separation) の考えに従って、特に UI と Model の境界を明確に layer ファーストでパッケージで分けつつ、各 layer（パッケージ）内では feature ファーストっぽく切る部分もある、というアプローチを取ります。

## なぜ layer ファーストなのか

layer ファーストで分けるということは、各レイヤーの責務と依存関係を主眼に置いて構成を考えるということです。

クライアントアプリケーションにおいて、最も強烈に区別するべきレイヤーは UI と Model であるという考えを取ります。

UI (User Interface) とはその名の通り、ユーザーとシステムの境界です。

画面に映し出された、ユーザーが目にする内容 (View) と、典型的にはボタンのような部品をユーザーが触って何らかの操作を行う部分 (Controller) から成ります。

Model は UI 以外のすべてで、システムの振る舞いそのものを含みます。

格闘ゲームを例にするならば、画面に映る情報が View、プレイヤーが手にするコントローラが Controller、キャラクターの挙動や、ヒット判定、ヒット時のダメージ計算や吹っ飛び率の計算などの格闘ゲームの振る舞いを司るのが Model です。

## パッケージとはなにか

## なぜパッケージに分けるのか

## Dart と Flutter の境界について

## system パッケージ

## repository パッケージ

## domain パッケージ

## base_ui パッケージ

## app パッケージ

## 例外ハンドリング

## 依存性の注入
