---
title: "GCP ã‚’æ´»ç”¨ã—ã¦ Firestore ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ã‚’ Dart ã§å‹•ã‹ã™"
emoji: "ğŸ¯"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Dart", "GCP", "gc24"]
published: false
published_at: 2024-02-25 00:00
---

## ã“ã®è¨˜äº‹ã«ã¤ã„ã¦

:::message
ã“ã®è¨˜äº‹ã¯ [è¨˜äº‹æŠ•ç¨¿ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³2024 Google Cloud](https://zenn.dev/topics/gc24) ã¨ã—ã¦ã‚‚æŠ•ç¨¿ã—ã¦ã„ã¾ã™ï¼
:::

ã“ã®è¨˜äº‹ã§ã¯ã€GCP ã®ã„ã‚ã„ã‚ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’æ´»ç”¨ã—ã¦ Firestore ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ã‚’ Dart ã§å‹•ã‹ã™æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

ç§è‡ªèº«ã€å€‹äººé–‹ç™ºãªã©ã§ã¯ Firebase ã‚’ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã™ãŒã€ãã®éš›ã€ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã§è¡Œã†ã¹ãå‡¦ç†ã¯ã“ã‚Œã¾ã§ TypeScript (JavaScript) ã§å®Ÿè£…ã—ã¦ Cloud Functions ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã¾ã—ãŸã€‚

æ™®æ®µã¯ Flutter, Dart ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã—ã¦ãŠã‚Šã€Dart è¨€èªãŒå¤§å¥½ããªã®ã§ã€Dart ã§ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã‚‚å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã‚Œã°å¬‰ã—ã„ãªã¨æ—¥ã€…æ€ã£ã¦ã„ãŸã¨ã“ã‚ã€ãã‚ŒãŒå®Ÿç¾ã§ããã†ãªæ–¹æ³•ã‚’æ¢ã‚‹ã“ã¨ãŒã§ããŸã®ã§ã¾ã¨ã‚ã¾ã™ã€‚

GCP ã® Cloud Run, Eventarc, Secret Manager ã‚„ Workload Identity ãªã©ã‚’æ´»ç”¨ã—ã¦

- HTTP é–¢æ•°ã‚’ Dart ã§æ›¸ã„ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹
- Firestore ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ã‚’ Dart ã§æ›¸ã„ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹
- GitHub Actions ã§ã€ã‚ã‚‹ç¨‹åº¦å¿«é©ãªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹

ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¾ã™ã€‚

æ³¨æ„ç‚¹ã¨ã—ã¦ã€

- ã“ã®è³‡æ–™ã§ç´¹ä»‹ã™ã‚‹ [dart_firebase_admin](https://pub.dev/packages/dart_firebase_admin) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€ã¾ã åˆæœŸæ®µéšã§å¯¾å¿œã—ã¦ã„ãªã„æ©Ÿèƒ½ã‚„ãƒã‚°ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€æ™‚ã«ã¯è‡ªã‚‰ãã®ãƒã‚°ã‚’è¿½ã£ã¦è§£æ±ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- Firebase CLI å†…éƒ¨ã§é«˜åº¦ã«æŠ½è±¡åŒ–ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¿ã‚¹ã‚¯ãªã©ã‚’ gcloud ã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‰ã§è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

ãªã©ã®ã€æ ¹æ°—ã‚„é–‹æ‹“ç²¾ç¥ã‚‚ä¸€å®šå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

ã‚ˆã£ã¦ç¾æ™‚ç‚¹ã§ã€Œä»Šå¾Œã¯ Firebase ã§ä½¿ç”¨ã™ã‚‹ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®å‡¦ç†ã¯ Dart ã§æ›¸ã“ã†ï¼ã€ã¨å¼·ãæ¨å¥¨ã™ã‚‹æ„å›³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãŒã€å€‹äººçš„ã«ã¯ã€ã¾ã è©¦ã—ãã‚Œã¦ã„ãªã„æ©Ÿèƒ½ã‚‚è§¦ã£ã¦ã¿ã¤ã¤ã€ä»Šå¾Œã¯ç©æ¥µçš„ã« Dart ã§ Firebase ã§ä½¿ç”¨ã™ã‚‹ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®å‡¦ç†ã‚’æ›¸ã„ã¦ã„ã“ã†ã¨è€ƒãˆã¦ã„ã¾ã™ã—ã€ã™ã§ã«ãã®ãã‚‰ã„ã¯ä½¿ãˆã‚‹æ°´æº–ã«é”ã—ã¦ãã¦ã„ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

## Cloud Run

Cloud Run ã«é–¢ã™ã‚‹èª¬æ˜ã‚’å¼•ç”¨ã—ã¾ã™ï¼š

> Cloud Run ã¯ã€Google ã®ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠã‚’ç›´æ¥å®Ÿè¡Œã§ãã‚‹ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚
>
> ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚‚ã®ã§ã‚ã‚Œã°ã€ä»»æ„ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§è¨˜è¿°ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ Cloud Run ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã¯ä»»æ„ã§ã™ã€‚Goã€Node.jsã€Pythonã€Javaã€.NET Coreã€Ruby ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä½¿ç”¨ã—ã¦ã„ã‚‹è¨€èªã®ãƒ™ã‚¹ãƒˆ ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹[ã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤](https://cloud.google.com/run/docs/deploying-source-code?hl=ja)Â ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

https://cloud.google.com/run/docs/overview/what-is-cloud-run?hl=ja

æ˜¨å¹´ã® Google I/O 2023 ã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã—ãŸãŒï¼ˆGA ã«ãªã£ãŸã®ã¯ 2022 å¹´ã§ã™ãŒï¼‰ã€Cloud Functions (2nd Gen) ã¯è£å´ã§ã¯ Cloud Run ã§å‹•ãã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

Cloud Functions (1st Gen) ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¨æ¯”ã¹ã¦ã‚‚æ©Ÿèƒ½çš„ã«ã¯å¤§å·®ã‚ã‚Šã¾ã›ã‚“ã€‚
`
å‚è€ƒï¼š

https://zenn.dev/cloud_ace/articles/b30971199b392c

é‡è¦ãªã“ã¨ã¯ã€Cloud Run ã®ã€Œã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚‚ã®ã§ã‚ã‚Œã°ã€ä»»æ„ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§è¨˜è¿°ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã€ã¨ã„ã†ç‰¹å¾´ã«ã‚ˆã‚Šã€Dart ã§æ›¸ã„ãŸé–¢æ•°ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’ Cloud Run ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

## dart_firebase_admin ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

[dart_firebase_admin](https://pub.dev/packages/dart_firebase_admin) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€Dart ã‚„ Flutter ã«é–¢ã‚ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã¯ã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ invertase ãŒé–‹ç™ºã—ã¦ã„ã‚‹ Dart å‘ã‘ã® Firebase Admin SDK ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚

https://pub.dev/packages/dart_firebase_admin

https://github.com/invertase/dart_firebase_admin

[dart_firebase_admin](https://pub.dev/packages/dart_firebase_admin) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æä¾›ã™ã‚‹æ©Ÿèƒ½ã®ã‚¹ã‚³ãƒ¼ãƒ—ã¯å¤§ã¾ã‹ã«

- Firebase Admin SDK ã‚’åˆ©ç”¨ã—ãŸ Admin æ¨©é™ã§ã® `adminApp` ã®åˆæœŸåŒ–
- Admin æ¨©é™ã‚’ç”¨ã„ãŸ Dart å‘ã‘ã® Firebase APIï¼ˆ[firebaseapis](https://pub.dev/packages/firebaseapis) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚å‚ç…§ï¼‰ã‚’é€šã˜ãŸ Firebase ã®å„ç¨®æ©Ÿèƒ½ã® API ã‚³ãƒ¼ãƒ«

ãªã©ã§ã™ã€‚

ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¦ã€Cloud Firestore, Firebase Auth, Firebase Messaging ãªã©ã®å„æ©Ÿèƒ½ã‚’ Admin æ¨©é™ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```dart
final adminApp = FirebaseAdminApp.initializeApp(
  'your-project-id',
  Credential.fromServiceAccountParams(
    clientId: 'your-client-id',
    privateKey: 'your-private-key',
    email: 'your-email',
  ),
);

final firestore = Firestore(adminApp);

final auth = Auth(adminApp);

final messaging = Messaging(adminApp);
```

## functions_framework ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

[functions_framework ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://pub.dev/packages/functions_framework) ã¯ã€GoogleCloudPlatform ã‚ªãƒ¼ã‚¬ãƒ‹ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ã€Dart ã§è¨˜è¿°ã—ã¦ Cloud Run ãªã©ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã¨ã‚µãƒ³ãƒ—ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚

https://pub.dev/packages/functions_framework

https://github.com/GoogleCloudPlatform/functions-framework-dart

ä»¥ä¸‹ã§ã¯ã„ã‚ˆã„ã‚ˆã€[functions_framework ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://pub.dev/packages/functions_framework) ã®å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’å‚è€ƒã«ã—ãªãŒã‚‰ã€Dart ã§æ›¸ã„ãŸé–¢æ•°ã‚’ Cloud Run ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

