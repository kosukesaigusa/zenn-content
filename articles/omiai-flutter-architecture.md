---
title: "Omiai の Flutter プロジェクトのアーキテクチャ"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Dart", "Flutter"]
published: false
published_at: 2024-09-20 00:00
---

## はじめに

株式会社 Omiai の Flutter テックリードの [@kosukesaigusa](https://github.com/kosukesaigusa) です。

株式会社 Omiai では、マッチングアプリの Omiai を、長年の間 iOS, Android (, Web) それぞれのプラットフォームで開発・運営してきています。

... 年のサービス提供開始からの長い歴史の中で、多くのユーザーに利用していただいているサービスになっている一方で、コードベースはかなり古くなり、技術的な負債や、それぞれのプラットフォーム間の仕様の差異など、多くの課題が蓄積してきました。

そこで、Flutter を新規導入することを決定し、既存の  iOS, Android (, Web) アプリを Flutter で少しずつリプレイスしていくプロジェクトが 2024 年 5 月頃から始まりました。

これから Omiai の Flutter プロジェクトにおける様々な取り組みを紹介していきます。

## この記事について

Omiai の Flutter プロジェクトを紹介する最初の記事として、ここでは、Omiai の Flutter プロジェクトのアーキテクチャの概要を紹介します。

※ この記事では、プロジェクト構成、採用するパッケージ、技術スタックなども含めて、広義に「アーキテクチャ」と表現している場合があります。

## アーキテクチャ策定の目的

文字通り、ゼロから Flutter プロジェクトを開始し、そのアーキテクチャを策定するにあたり、まずは以下のような目的を定めました。

既存の  iOS, Android (, Web) アプリを Flutter でリプレイスしていくことに投資することを決断した目的に沿ったものである必要があります。

定量目標の例：

- 〇〇 サイズの「典型的な実装タスク」は、 N 日以内に実装を完了し、QA Ready の状態になる
- 〇〇 サイズの「典型的な修正タスク」は、N 日以内に実装を完了し、QA Ready の状態になる
- 例えば現状「（ざっくり）N 人日くらいかな（根拠は過去の経験）」と見積もっている実装タスクを、下記のような根拠と具体度とともに、見積もりおよびタスク分解できる
  - repository パッケージに、新たに X 個の API エンドポイントと通信する Repository の実装が必要
  - domain パッケージに、Y 個の新規実装（業務概念の定義や `Notifier`, `UseCase` の実装）が必要
  - app パッケージに、Z 個の UI 部品の実装が必要
  - よって、repository, domain, app の順で、それぞれ x, y, z 個の PR を作成する計画で、それぞれ, a, b, c 日ずつかかると見積もれる
- 業務概念や業務ロジックを実装する層 (domain) と、それより抽象的な層（repository, system など）全てで、ユニットテストをカバレッジ 100% で記述できる（それを前提に上記の見積もりができる）
- 新規参画者が N 日以内にアーキテクチャを理解可能で、タスクに着手することが可能

定性目標の例：

- 特に domain パッケージのソースコードは、「実行可能な仕様」と呼べるレベルで記述できる
- Flutter コミュニティの潮流を取り入れて、エンジニアにとって一定以上魅力的なアーキテクチャ策定、ライブラリ選定がされる

:::message

- 「典型的な実装タスク」は、プロダクトやサーバサイドの要件や仕様がどのくらい固まっているか、基盤のような実装の追加や変更の必要性やその具合、その他の技術的な不確実性などにも言及して、別途定義しています。
- 「〇〇 サイズ」「N 日以内」などは、記事で紹介するにはやや具体的過ぎるので省略しました
- app, domain, repository などのパッケージ名は以下で説明します

:::

